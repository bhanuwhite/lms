<div class="surface-ground px-4 p-4">
  <div class="row">
    <div class="col-lg-6 d-flex align-items-center">
      <h2 class="text-black">
        Content
      </h2>
    </div>
    <div class="col-lg-6 d-flex justify-content-end align-items-center">
      <div class="drop-button">
        <button class="btn btn-primary mb-2 " type="button" (click)="showDialog()" icon="pi pi-info-circle"
          label="Add"><i class="pi pi-plus me-2 cursor-pointer"></i>Add Content</button>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-4 mb-3" *ngFor="let data of contentData">
      <div *ngFor="let i of data?.attributes?.media?.data">
        <div class="card" style="height: 400px; width: 95%;">
          <ng-container *ngIf="i.attributes?.formats != null; then content  else video1"></ng-container>
          <ng-template #content>
            <img [routerLink]="['/admin/content',data.id]" style="height: 230px;cursor: pointer;"
              src="{{i.attributes.formats?.thumbnail?.url}}" class="card-img-top" alt="...">
          </ng-template>
          <ng-template #video1>

            <video #vid class="cursor-pointer" height="250px;" (timeupdate)="updateProgress(vid)" controls>
              <source src="{{i.attributes.url}}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </ng-template>
          <div class="card-body">
            <div class="row cursor-pointer" [routerLink]="['/admin/content',data.id]">
              <div class="col-lg-6">
                <h3 class="card-title mb-2" style="font-weight: bold;">{{data.attributes.name}}</h3>
              </div>
              <div class="col-lg-6 d-flex justify-content-end">
                <span class="d-flex mb-2 align-items-center"> <mat-icon style="font-size: 20px;"
                    fontIcon="person"></mat-icon> {{data.attributes.author}}</span>
              </div>
            </div>
            <!-- <p-progressBar [style]="{height: '8px',width:'150px'}" [class.hide]="true" [showValue]="false"
              [value]="percentage"></p-progressBar>
            <p style="font-size: small;">{{percentage}}% Completed</p> -->
            <p [routerLink]="['/admin/content',data.id]" class="card-text cursor-pointer">
              {{data.attributes.description}}.</p>
            <div class="row align-items-center cursor-pointer">
              <div class="col-lg-4">
                <span class="d-flex align-items-center" [routerLink]="['/admin/content',data.id]">
                  <mat-icon aria-hidden="false" aria-label="Example home icon" fontIcon="visibility"></mat-icon><span
                    class="ms-1">14</span>
                </span>
              </div>
              <div class="col-lg-4"><button type="button" class="btn" [routerLink]="['/admin/content',data.id]">
                  {{data.attributes.price | currency : 'INR'}}</button>
              </div>
              <div class="col-lg-4 d-flex justify-content-end">
                <div class="d-flex justify-content-end mt-2">
                  <button pButton pRipple type="button" pTooltip="Edit Course" icon="pi pi-pencil"
                    class="p-button-rounded p-button-outlined" (click)="editContentDialog(data)"
                    style="height: 2rem; width: 2rem;"></button>

                  <button pButton pRipple type="button" pTooltip="Delete Course" icon="pi pi-times"
                    class="p-button-rounded ms-1 p-button-danger p-button-outlined" style="height: 2rem; width: 2rem;"
                    (click)="deleteDialog(data)"></button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000"></p-confirmDialog>
</div>

<!-- Add Content Form -->
<div class=" container">
  <div class="d-flex justify-content-end">
    <p-dialog header="Add Content" [(visible)]="display" [style]="{width: '40vw'}" styleClass="active" [modal]="true">
      <hr>
      <form [formGroup]="courseGroup" (ngSubmit)="onSubmitContent()">
        <div class="p-fluid grid">
          <div class="field mt-2 w-100">
            <label for="title">Content Name</label>
            <span class="p-float-label">
              <input type="text" class="bg-light-grey input-shadow w-100 p-inputtext" name="title" class="form-control"
                required formControlName="title" pInputText placeholder="Content Name">
              <small class="p-error block"
                *ngIf="courseGroup.get('title')?.invalid && (courseGroup.get('title')?.dirty || courseGroup.get('title')?.touched)">
                Content name is required. </small>
            </span>
          </div>
          <div class="field mt-2 w-100">
            <label for="description"> Description </label>
            <span class="p-float-label">
              <textarea inputId="textarea" required class="bg-light-grey input-shadow w-100 p-inputtext" rows="3"
                style="resize: none;" cols="30" formControlName="description" pInputTextarea></textarea>
              <small class="p-error block"
                *ngIf="courseGroup.get('description')?.invalid && (courseGroup.get('description')?.dirty || courseGroup.get('description')?.touched)">
                Description name is required</small>
            </span>
          </div>
          <div class="field mt-2 w-100">
            <label for="author">Author</label>
            <span class="p-float-label">
              <input type="text" class="bg-light-grey input-shadow w-100 p-inputtext" formControlName="author"
                pInputText>
              <small class="p-error block"
                *ngIf="courseGroup.get('author')?.touched && courseGroup.get('author')?.invalid">
                Author name Required.
              </small>
            </span>
          </div>
          <div class="field mt-2 w-100">
            <label for="price"> Price (&#x20b9;) </label>
            <span class="p-float-label">
              <input type="number" class="bg-light-grey input-shadow w-100 p-inputtext" formControlName="price"
                pInputText>
              <small class="p-error block"
                *ngIf="courseGroup.get('price')?.invalid && (courseGroup.get('price')?.dirty || courseGroup.get('price')?.touched)">
                Price name is required</small>
            </span>
          </div>
          <div class="field mt-4 w-100">
            <label for="content">Content</label>
            <span class="p-float-label mb-1">
              <input type="file" required class="bg-light-grey input-shadow w-100 p-inputtext">
              <input type="file" required=""  class="bg-light-grey input-shadow w-100 p-inputtext" #imgInput
                (change)="onFileSelect($event)" pInputText>
            </span>
            <small class="p-error block" *ngIf="courseGroup.get('img')?.touched && courseGroup.get('img')?.invalid">
              Please select a image
            </small>
            <p-progressBar *ngIf="isProgressFile== true" mode="indeterminate"
              [style]="{'height': '6px'}"></p-progressBar>
          </div>
        </div>
        <div class="d-flex justify-content-between mt-2">
          <button (click)="closeDialog()" type="button" class="btn btn-dark"><i
              class="pi pi-delete-left me-2 cursor-pointer"></i>Cancel</button>
          <button type="button" class="btn btn-success me-2" (click)="onSubmitContent()"><i
              class="pi pi-save me-2 cursor-pointer"></i>Save</button>
        </div>
      </form>
    </p-dialog>


    <!-- Edit dialog start here -->
    <p-dialog header="Update Courses" [(visible)]="editDisply" [style]="{width: '40vw'}" styleClass="active"
      [modal]="true">
      <hr>
      <form [formGroup]="courseUpdateGroup">
        <div class="p-fluid grid">
          <div class="field mt-2 w-100">
            <label for="title">Course Name</label>
            <span class="p-float-label">
              <input type="text" class="bg-light-grey input-shadow w-100 p-inputtext" formControlName="title" pInputText
                placeholder="Course Name">
              <small class="p-error block"
                *ngIf="courseUpdateGroup.get('title')?.invalid && courseUpdateGroup.get('title')?.touched">
                Course name is required.
              </small>
            </span>
          </div>
          <div class="field mt-2 w-100">
            <label for="title">Description</label>
            <span class="p-float-label">
              <textarea inputId="textarea" class="bg-light-grey input-shadow w-100 p-inputtext" rows="3"
                style="resize: none;" cols="30" formControlName="description" pInputTextarea></textarea>
            </span>
            <small class="p-error block"
              *ngIf="courseUpdateGroup.get('description')?.invalid && courseUpdateGroup.get('description')?.touched">
              Description name is required.
            </small>
          </div>
          <div class="field mt-2 w-100">
            <label for="title">Author</label>
            <span class="p-float-label">
              <input type="text" class="bg-light-grey input-shadow w-100 p-inputtext" formControlName='author'
                pInputText>
              <small class="p-error block"
                *ngIf="courseUpdateGroup.get('author')?.invalid && courseUpdateGroup.get('author')?.touched">
                Authors name is required.
              </small>
            </span>
          </div>
          <div class="field mt-1 w-100">
            <label for="title">Price (&#x20b9;)</label>
            <span class="p-float-label">
              <input type="text" class="bg-light-grey input-shadow w-100 p-inputtext" formControlName="price"
                pInputText>
              <small class="p-error block"
                *ngIf="courseUpdateGroup.get('price')?.invalid && courseUpdateGroup.get('price')?.touched">
                Price name is required.
              </small>
            </span>
          </div>
          <div class="field mt-4 w-100">
            <label for="title">Content</label>
            <span class="p-float-label">
              <input type="file" class="bg-light-grey input-shadow w-100 p-inputtext" #fileInput
                (change)="onFileSelectForUpdate($event)" pInputText>
            </span>
          </div>
          <div class="row  mt-1">
          </div>
        </div>
        <div class="d-flex justify-content-end mt-2">
          <button type="button" class="btn btn-success me-2" (click)="onUpdateContent()"><i
              class="pi pi-save me-2 cursor-pointer"></i>Update</button>
          <button type="button" class="btn btn-dark" (click)="closeEditDialog()"><i class="pi pi-delete-left me-2 cursor-pointer">
          </i>Cancel</button>
        </div>
      </form>
    </p-dialog>
    <!-- Edit dialog ends here-->
  </div>
  <p-toast position="top-right"></p-toast>
  <app-spinner *ngIf="loadingSpinner==true"></app-spinner>
</div>
